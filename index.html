<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Himalaya Cat: Masterpiece</title>
    <style>
        :root { --gold: #FFD700; --red: #ff3333; --cyan: #00f2ff; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #000; font-family: 'Segoe UI', sans-serif; }
        
        #overlay { 
            position: fixed; inset: 0; background: rgba(0,0,0,0.9); 
            z-index: 1000; display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .window { 
            background: linear-gradient(145deg, #0a0a1a, #000); padding: 30px; 
            border-radius: 40px; border: 2px solid var(--gold); text-align: center;
            width: 90%; max-width: 480px; box-shadow: 0 0 50px rgba(255, 215, 0, 0.15);
        }
        .shop-grid { 
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin: 15px 0;
            max-height: 160px; overflow-y: auto; background: rgba(255,255,255,0.03); padding: 10px; border-radius: 20px;
        }
        .card { background: #111; padding: 10px; border-radius: 12px; border: 1px solid #333; cursor: pointer; font-size: 11px; transition: 0.2s; }
        .card.active { border-color: var(--gold); background: #221a00; transform: scale(1.05); }

        .btn-start { 
            background: var(--gold); color: #000; padding: 18px 60px; border-radius: 50px; 
            border: none; font-size: 24px; font-weight: bold; cursor: pointer; margin-top: 20px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
        }
        #hud { 
            position: fixed; top: 15px; width: 100%; display: flex; justify-content: space-around;
            z-index: 500; font-weight: bold; color: var(--gold); pointer-events: none;
        }
        canvas { display: block; width: 100%; height: 100%; }
    </style>
</head>
<body>

<div id="hud">
    <div>ğŸ’° Ø§Ù„Ø°Ù‡Ø¨: <span id="c-val">0</span></div>
    <div>ğŸ“ Ø§Ù„Ù…Ø±Ø­Ù„Ø© <span id="s-val">1</span></div>
    <div>ğŸ“ <span id="d-val">0</span>Ù…</div>
</div>

<div id="overlay">
    <div class="window">
        <h2 style="color:var(--gold); margin:0;" id="m-title">Ù…Ù‡Ù…Ø© Ø¥Ù†Ù‚Ø§Ø° Ø§Ù„Ù‡ÙŠÙ…Ø§Ù„Ø§ÙŠØ§ ğŸ¾</h2>
        <div class="shop-grid" id="shop"></div>
        <div style="background:rgba(255, 51, 51, 0.05); padding:15px; border-radius:20px; border:1px dashed var(--red);">
            <p style="margin:0; font-size:13px; color:#fff;">ØªØ¨Ø±Ø¹ $1 Ù„Ø¯Ø¹Ù… Ø§Ù„Ù‚Ø·Ø· Ø§Ù„Ù…ØµØ§Ø¨Ø©</p>
            <button onclick="playSFX(200,'sawtooth',0.3)" style="background:var(--red); border:none; color:white; padding:6px 20px; border-radius:10px; cursor:pointer; margin-top:10px; font-weight:bold;">ØªØ¨Ø±Ø¹ Ø§Ù„Ø¢Ù†</button>
        </div>
    </div>
    <button class="btn-start" onclick="start()">Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨ ğŸš€</button>
</div>

<script>
const cvs = document.createElement('canvas');
document.body.appendChild(cvs);
const ctx = cvs.getContext('2d');

const imgC = new Image(); imgC.src = 'https://cdn-icons-png.flaticon.com/512/1864/1864514.png';
const imgM = new Image(); imgM.src = 'https://cdn-icons-png.flaticon.com/512/1211/1211053.png';
const imgG = new Image(); imgG.src = 'https://cdn-icons-png.flaticon.com/512/2489/2489756.png';

let active = false, stage = 1, score = 0, dist = 0, frame = 0, shake = 0;
let obs = [], gold = [], pts = [];
let p = { x: 0, y: 0, v: 0, g: 0.45, j: -9.5, w: 70, h: 60 };

const audio = new (window.AudioContext || window.webkitAudioContext)();
function playSFX(f, t, d) {
    if(audio.state === 'suspended') audio.resume();
    let o = audio.createOscillator(), g = audio.createGain();
    o.type = t; o.frequency.setValueAtTime(f, audio.currentTime);
    g.gain.exponentialRampToValueAtTime(0.01, audio.currentTime + d);
    o.connect(g); g.connect(audio.destination); o.start(); o.stop(audio.currentTime + d);
}

function resize() {
    cvs.width = window.innerWidth; cvs.height = window.innerHeight;
    p.x = cvs.width * 0.15;
}
window.onresize = resize; resize();

for(let i=1; i<=20; i++) {
    const d = document.createElement('div');
    d.className = `card ${i==1?'active':''}`; d.id = `st${i}`;
    d.innerHTML = `Ù…ØªØ¬Ø± ${i}<br>$0.99`;
    d.onclick = () => {
        stage = i; document.querySelectorAll('.card').forEach(c=>c.classList.remove('active'));
        d.classList.add('active'); playSFX(400, 'sine', 0.1);
    };
    document.getElementById('shop').appendChild(d);
}

function start() {
    active = true; dist = 0; obs = []; gold = []; pts = []; frame = 0;
    p.y = cvs.height/2; p.v = 0;
    document.getElementById('overlay').style.display = 'none';
    playSFX(150, 'square', 0.5);
    loop();
}

function spawnPt(x, y, color) {
    for(let i=0; i<8; i++) pts.push({x, y, vx: (Math.random()-0.5)*10, vy: (Math.random()-0.5)*10, a: 1, c: color});
}

function loop() {
    if(!active) return;
    frame++; dist += 2;
    document.getElementById('d-val').innerText = Math.floor(dist/10);
    document.getElementById('s-val').innerText = stage;
    document.getElementById('c-val').innerText = score;

    ctx.save();
    if(shake > 0) { ctx.translate(Math.random()*shake, Math.random()*shake); shake *= 0.9; }

    // Ø®Ù„ÙÙŠØ© Ù…ØªØ¯Ø±Ø¬Ø© (Gradient)
    let grd = ctx.createLinearGradient(0, 0, 0, cvs.height);
    grd.addColorStop(0, "#050510"); grd.addColorStop(1, "#1a0a2e");
    ctx.fillStyle = grd; ctx.fillRect(0, 0, cvs.width, cvs.height);

    // Ø¯Ù‡Ø§Ù„ÙŠØ² ØµØ®Ø±ÙŠØ©
    let wallH = (cvs.height * 0.15) + Math.sin(frame*0.02) * 40;
    ctx.fillStyle = `hsla(${stage * 50}, 70%, 15%, 0.9)`;
    ctx.fillRect(0, 0, cvs.width, wallH); ctx.fillRect(0, cvs.height - wallH, cvs.width, wallH);

    // Ø§Ù„Ù‚Ø·Ø©
    p.v += p.g; p.y += p.v;
    ctx.save();
    ctx.translate(p.x + p.w/2, p.y + p.h/2);
    ctx.scale(-1, 1); ctx.rotate(p.v * 0.03);
    ctx.drawImage(imgC, -p.w/2, -p.h/2, p.w, p.h);
    ctx.restore();

    // Ø§Ù„Ø¬Ø²ÙŠØ¦Ø§Øª (Particles)
    pts.forEach((pt, i) => {
        pt.x += pt.vx; pt.y += pt.vy; pt.a -= 0.02;
        ctx.fillStyle = `rgba(${pt.c}, ${pt.a})`;
        ctx.fillRect(pt.x, pt.y, 4, 4);
        if(pt.a <= 0) pts.splice(i, 1);
    });

    // Ø§Ù„Ø°Ù‡Ø¨
    if(frame % 90 == 0) gold.push({x: cvs.width, y: wallH + 50 + Math.random()*(cvs.height - wallH*2 - 100)});
    gold.forEach((g, i) => {
        g.x -= 6; ctx.drawImage(imgG, g.x, g.y, 35, 35);
        if(Math.hypot(p.x+35-g.x, p.y+30-g.y) < 40) {
            spawnPt(g.x, g.y, "255, 215, 0");
            gold.splice(i,1); score++; playSFX(800, 'sine', 0.1);
        }
    });

    // Ø§Ù„ÙˆØ­ÙˆØ´
    if(frame > 100 && frame % Math.max(30, 100 - stage*4) == 0) {
        obs.push({x: cvs.width, y: wallH + Math.random()*(cvs.height - wallH*2 - 80), s: 70});
    }
    obs.forEach((o, i) => {
        o.x -= (7 + stage*0.4); ctx.drawImage(imgM, o.x, o.y, o.s, o.s);
        if(p.x+15 < o.x+o.s-15 && p.x+p.w-15 > o.x+15 && p.y+15 < o.y+o.s-15 && p.y+p.h-15 > o.y+15) end();
        if(o.x < -100) obs.splice(i, 1);
    });

    if(p.y < wallH - 15 || p.y > cvs.height - wallH - p.h + 15) end();
    if(dist > 3500) { active = false; stage++; document.getElementById('overlay').style.display = 'flex'; }

    ctx.restore();
    requestAnimationFrame(loop);
}

function end() {
    active = false; shake = 20; playSFX(100, 'sawtooth', 0.6);
    document.getElementById('m-title').innerText = "ğŸ’€ Ø³Ù‚Ø·Øª Ø§Ù„Ù‚Ø·Ø©!";
    document.getElementById('overlay').style.display = 'flex';
}

const jump = (e) => { if(active) { p.v = p.j; playSFX(600, 'triangle', 0.1); } if(e) e.preventDefault(); };
window.onmousedown = jump; window.ontouchstart = jump;
</script>
</body>
</html>